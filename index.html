<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Jalaram Academy v256</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

    <style>
        :root { 
            --primary: #4f46e5; --bg: #f8fafc; --text: #0f172a; 
            --glass: rgba(255, 255, 255, 0.95);
        }
        * { margin:0; padding:0; box-sizing:border-box; font-family:'Plus Jakarta Sans',sans-serif; -webkit-tap-highlight-color:transparent; }
        body { background:var(--bg); color:var(--text); height:100vh; display:flex; flex-direction:column; overflow:hidden; }

        /* --- AUTH --- */
        #auth-layer { position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:5000; display:flex; flex-direction:column; align-items:center; justify-content:center; }
        .auth-card { width:320px; text-align:center; }

        /* --- HEADER & MOOD --- */
        .emo-header { background:linear-gradient(135deg, #4f46e5, #818cf8); padding:20px; color:white; border-radius:0 0 25px 25px; box-shadow:0 4px 20px rgba(79, 70, 229, 0.2); flex-shrink:0; }
        .mood-row { display:flex; gap:10px; margin-top:15px; overflow-x:auto; padding-bottom:5px; }
        .mood-chip { background:rgba(255,255,255,0.2); padding:6px 12px; border-radius:20px; font-size:12px; border:1px solid rgba(255,255,255,0.1); white-space:nowrap; }

        /* --- LAYOUT --- */
        .app-shell { display:flex; flex:1; overflow:hidden; }
        .main-content { flex:1; overflow-y:auto; padding:20px; padding-bottom:100px; }

        /* --- CARDS & UI --- */
        .u-card { background:white; padding:15px; border-radius:16px; box-shadow:0 4px 10px rgba(0,0,0,0.03); margin-bottom:15px; border:1px solid #e2e8f0; }
        .row { display:flex; justify-content:space-between; align-items:center; }
        .btn { padding:12px; border:none; border-radius:10px; font-weight:700; cursor:pointer; width:100%; font-size:13px; margin-bottom:10px; display:flex; align-items:center; justify-content:center; gap:5px; }
        .btn-sm { width:auto; padding:6px 12px; margin:0; }
        .btn-main { background:var(--primary); color:white; }
        .btn-sec { background:#f1f5f9; color:#475569; border:1px solid #cbd5e1; }
        .btn-red { background:#fee2e2; color:#991b1b; }
        input, select { width:100%; padding:12px; border:2px solid #e2e8f0; border-radius:10px; margin-bottom:10px; outline:none; background:white; }

        /* --- PIE CHART (CSS ONLY) --- */
        .pie-chart { width:24px; height:24px; border-radius:50%; background:conic-gradient(var(--primary) 0% 0%, #e2e8f0 0% 100%); transition:0.3s; transform:rotate(-90deg); }
        .grade-badge { font-size:10px; font-weight:bold; padding:2px 6px; border-radius:4px; background:#e0e7ff; color:var(--primary); margin-left:5px; }

        /* --- CHECKBOX GRID --- */
        .check-grid { display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px; text-align:left; }
        .check-item { display:flex; align-items:center; gap:8px; font-size:13px; background:#f8fafc; padding:8px; border-radius:8px; border:1px solid #eee; }
        
        /* --- LEADERBOARD & CHAT --- */
        .podium { display:flex; align-items:flex-end; justify-content:center; gap:10px; height:120px; margin-bottom:20px; }
        .pod-bar { width:60px; border-radius:10px 10px 0 0; display:flex; flex-direction:column; align-items:center; justify-content:flex-end; padding-bottom:5px; color:white; font-weight:bold; position:relative; }
        .rank-1 { height:100%; background:#f59e0b; } .rank-2 { height:80%; background:#94a3b8; } .rank-3 { height:60%; background:#b45309; }
        .crown { position:absolute; top:-25px; font-size:20px; }
        
        .chat-item { display:flex; gap:10px; padding:15px; border-bottom:1px solid #f1f5f9; align-items:center; }
        .chat-win { position:fixed; top:0; left:0; width:100%; height:100%; background:white; z-index:2000; display:none; flex-direction:column; }
        .chat-body { flex:1; background:#f8fafc; padding:15px; overflow-y:auto; }
        .msg { max-width:70%; padding:8px 12px; border-radius:15px; font-size:13px; margin-bottom:5px; clear:both; }
        .msg-me { float:right; background:var(--primary); color:white; }
        .msg-them { float:left; background:#e2e8f0; }

        /* --- MODALS --- */
        .sheet-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); z-index:9000; display:none; align-items:flex-end; backdrop-filter:blur(4px); }
        .sheet { background:white; width:100%; border-radius:30px 30px 0 0; padding:25px; box-shadow:0 -10px 40px rgba(0,0,0,0.1); transform:translateY(100%); transition:transform 0.3s; max-height:85vh; overflow-y:auto; display:flex; flex-direction:column; }
        .sheet.active { transform:translateY(0); }
        .sheet-handle { width:40px; height:5px; background:#e2e8f0; border-radius:10px; margin:0 auto 20px auto; }
        
        /* --- NAV --- */
        .bot-nav { position:fixed; bottom:0; width:100%; background:white; display:flex; justify-content:space-around; padding:10px; border-top:1px solid #eee; z-index:900; }
        .nav-item { text-align:center; font-size:10px; color:#94a3b8; font-weight:600; flex:1; }
        .nav-item.active { color:var(--primary); }
        .nav-item i { font-size:24px; display:block; margin-bottom:2px; }
        
        .teacher-only, .admin-only { display:none; }
        .sim-banner { background:#f97316; color:white; text-align:center; padding:8px; font-weight:bold; font-size:11px; cursor:pointer; display:none; }
    </style>
</head>
<body>

    <div id="auth-layer">
        <div class="auth-card">
            <div style="font-size:60px; margin-bottom:10px;">üéì</div>
            <h2 style="color:var(--primary); margin-bottom:20px;">Jalaram Academy</h2>
            <select id="l-role"><option>Admin</option><option>Teacher</option><option>Student</option></select>
            <input id="l-id" placeholder="ID (e.g. ADM-001)">
            <input type="password" id="l-pass" placeholder="PIN (1234)">
            <button class="btn btn-main" onclick="login()">Login</button>
            <div style="margin-top:15px; border-top:1px solid #eee; padding-top:15px;">
                <button class="btn btn-sec" onclick="openSheet('reg-sheet')">New Registration</button>
                <button class="btn btn-sec" onclick="openSheet('public-sheet')">View Courses</button>
            </div>
        </div>
    </div>

    <div id="app-layer" style="display:none; height:100%; flex-direction:column;">
        
        <div class="emo-header">
            <div class="row">
                <div style="font-weight:800; font-size:18px;">Jalaram Academy</div>
                <div id="u-chip" style="font-size:11px; background:rgba(255,255,255,0.2); padding:4px 10px; border-radius:15px;">User</div>
            </div>
            <div class="emo-greet" id="greet-text">Hello!</div>
            <div style="opacity:0.9; font-size:13px;">Let's learn something new.</div>
            <div class="mood-row" id="mood-bar">
                <div class="mood-chip">üòÑ Happy</div><div class="mood-chip">üß† Focused</div><div class="mood-chip">üò¥ Tired</div>
            </div>
        </div>

        <div class="sim-banner" id="sim-bar" onclick="location.reload()">‚ö†Ô∏è SIMULATING - TAP TO EXIT</div>

        <main class="main-content">
            <div id="pane-home" class="pane">
                <div class="u-card">
                    <h3>üèÜ Leaderboard</h3>
                    <div class="podium">
                        <div class="pod-bar rank-2"><div class="crown">ü•à</div><small>Rohan</small>92%</div>
                        <div class="pod-bar rank-1"><div class="crown">üëë</div><small>Anjali</small>98%</div>
                        <div class="pod-bar rank-3"><div class="crown">ü•â</div><small>Dev</small>89%</div>
                    </div>
                    <div id="lb-list"></div>
                </div>
            </div>

            <div id="pane-batches" class="pane" style="display:none;">
                <div class="u-card row"><h3>Classes</h3><button class="btn btn-sm btn-sec admin-only" onclick="addBatch()">+ Batch</button></div>
                <div id="batch-grid" style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"></div>
                
                <div id="batch-view" style="display:none; margin-top:20px;">
                    <div class="u-card">
                        <div class="row"><b id="bv-title">Class</b><button class="btn btn-sm btn-sec" onclick="closeBatch()">Close</button></div>
                        <div class="teacher-only" style="margin-top:10px; padding:10px; background:#f0f9ff; border:1px solid #bfdbfe; border-radius:10px;">
                            <div style="font-size:11px; font-weight:bold; color:var(--primary);">‚ö° QUANTUM GENERATOR</div>
                            <input id="q-topic" placeholder="Topic" style="margin:5px 0;">
                            <div class="row"><select id="q-buf" style="width:48%; margin:0;"><option value="0">No Buffer</option><option value="10">Buffer: 10m</option></select><button class="btn btn-main btn-sm" style="width:48%;" onclick="alert('Quantum Sent!')">Notify</button></div>
                        </div>
                        <div class="row" style="margin-top:10px;"><b>Students</b><div><button class="btn btn-sm btn-sec" onclick="renderStuList('att')">Att</button> <button class="btn btn-sm btn-sec" onclick="setupMarks()">Marks</button></div></div>
                        
                        <div id="marks-setup" style="display:none; background:#fff7ed; padding:10px; border:1px solid #fed7aa; border-radius:8px; margin-top:10px;">
                            <b style="color:#c2410c; font-size:12px;">TEST SETUP</b>
                            <div class="row" style="margin-top:5px;">
                                <input id="test-name" placeholder="Test Name (e.g. Unit 1)" style="width:60%;">
                                <input id="test-total" type="number" placeholder="Total" style="width:35%;" onchange="enableMarksEntry()">
                            </div>
                        </div>

                        <div id="bv-list"></div>
                    </div>
                </div>
            </div>

            <div id="pane-chat" class="pane" style="display:none;">
                <div class="u-card"><h3>Messages</h3><div id="chat-list"></div></div>
            </div>

            <div id="pane-store" class="pane" style="display:none;">
                <div class="u-card row"><h3>Store</h3><button class="btn btn-sm btn-sec admin-only" onclick="addMaterial()">+ Add</button></div>
                <div class="u-card"><h4>Free Demos</h4><div id="demo-list"></div></div>
                <div class="u-card"><h4>Premium</h4><div id="store-list"></div></div>
            </div>

            <div id="pane-admin" class="pane" style="display:none;">
                <div class="u-card">
                    <div class="row"><h3>Database</h3><button class="btn btn-sm btn-sec" onclick="openSheet('reg-sheet')">+ User</button></div>
                    <input placeholder="Search..." onkeyup="renderUsers(this.value)">
                    <div id="user-list"></div>
                </div>
                <div class="u-card">
                    <div class="row"><h3>Courses</h3><button class="btn btn-sm btn-sec" onclick="addCourse()">+ Course</button></div>
                    <div id="course-list"></div>
                </div>
                <div class="u-card"><h3>Approval Queue</h3><div id="pending-list"></div></div>
            </div>

            <div id="pane-profile" class="pane" style="display:none;">
                <div class="u-card">
                    <h4>Profile</h4>
                    <label style="font-size:11px; font-weight:bold;">USER ID</label><input id="prof-id" readonly style="background:#eee;">
                    <label style="font-size:11px; font-weight:bold;">NAME</label><input id="prof-name">
                    <button class="btn btn-main" onclick="alert('Saved')">Update</button>
                </div>
            </div>
        </main>
        <div class="bot-nav" id="bot-nav"></div>
    </div>

    <div id="reg-sheet" class="sheet-overlay" onclick="closeSheet('reg-sheet')">
        <div class="sheet" onclick="event.stopPropagation()">
            <div class="sheet-handle"></div>
            <h3>New Registration</h3>
            <select id="r-role" onchange="toggleRegFields()"><option>Student</option><option>Teacher</option></select>
            <input id="r-name" placeholder="Full Name">
            
            <div id="r-stu-fields">
                <input id="r-sm" placeholder="Student Mobile">
                <input id="r-pm" placeholder="Parent Mobile">
                <select id="r-batch"></select>
            </div>

            <div id="r-tch-fields" style="display:none;">
                <input id="r-subs" placeholder="Subjects (e.g. Maths, Physics)">
                <small style="color:gray;">Enter subjects separated by comma</small>
            </div>

            <input id="r-pass" placeholder="Create PIN">
            <button class="btn btn-main" onclick="doReg()">Register</button>
        </div>
    </div>

    <div id="public-sheet" class="sheet-overlay" onclick="closeSheet('public-sheet')">
        <div class="sheet" onclick="event.stopPropagation()">
            <div class="sheet-handle"></div>
            <h3>Courses</h3>
            <div style="padding:10px; border-bottom:1px solid #eee; cursor:pointer;" onclick="aiDesc('Maths')"><b>Maths</b><br><small>Click for AI Info</small></div>
            <div style="padding:10px; border-bottom:1px solid #eee; cursor:pointer;" onclick="aiDesc('Science')"><b>Science</b><br><small>Click for AI Info</small></div>
            <div id="ai-out" style="margin-top:10px; padding:10px; background:#f8fafc; font-size:13px;"></div>
        </div>
    </div>

    <div id="edit-sheet" class="sheet-overlay" onclick="closeSheet('edit-sheet')">
        <div class="sheet" onclick="event.stopPropagation()">
            <div class="sheet-handle"></div>
            <h3>Edit User</h3>
            <input type="hidden" id="e-id">
            <input id="e-name" placeholder="Name">
            
            <div id="e-stu-access" style="display:none;">
                <label style="font-size:11px; font-weight:bold;">SUBJECT ACCESS</label>
                <div class="check-grid" id="sub-ticks"></div>
            </div>

            <button class="btn btn-main" onclick="saveEdit()">Save</button>
            <button class="btn btn-sec" onclick="simUser()">üëÅÔ∏è Simulate</button>
            <button class="btn btn-red" onclick="delUser()">Delete User</button>
        </div>
    </div>

    <div id="chat-win" class="chat-win">
        <div class="row" style="padding:15px; border-bottom:1px solid #eee;"><i class="material-icons" onclick="document.getElementById('chat-win').style.display='none'">arrow_back</i><b id="cw-title">Chat</b><div></div></div>
        <div class="chat-body" id="cw-body"></div>
        <div style="padding:10px; border-top:1px solid #eee; display:flex; gap:10px;"><input placeholder="Type..." style="margin:0;"><button class="btn btn-main" style="width:auto;">Send</button></div>
    </div>

    <script>
        // --- DATA ---
        let users = [
            {n:'Admin', m:'ADM-001', p:'1234', role:'Admin'},
            {n:'Amit Sir', m:'TCH-001', p:'1234', role:'Teacher', subjects:'Maths, Science'},
            {n:'Rohan', m:'STU-001', p:'1234', role:'Student', batch:'Class 10 A', marks:95, access:['Maths']},
            {n:'Anjali', m:'STU-002', p:'1234', role:'Student', batch:'Class 10 A', marks:98, access:['Maths', 'Science']}
        ];
        let pending = [];
        let batches = ['Class 10 A', 'Class 12'];
        let store = [{t:'Algebra', type:'Demo'}, {t:'Physics PDF', type:'Premium'}];
        let globalSubjects = ['Maths', 'Science', 'English'];
        let currentUser = null;
        let activeTotalMarks = 100; // Default

        // Reset
        try { if(!localStorage.getItem('v256')) { localStorage.clear(); localStorage.setItem('v256','true'); } else {
            if(localStorage.getItem('ja_users')) users=JSON.parse(localStorage.getItem('ja_users'));
            if(localStorage.getItem('ja_pending')) pending=JSON.parse(localStorage.getItem('ja_pending'));
            if(localStorage.getItem('ja_batches')) batches=JSON.parse(localStorage.getItem('ja_batches'));
            if(localStorage.getItem('ja_subs')) globalSubjects=JSON.parse(localStorage.getItem('ja_subs'));
        }} catch(e){}

        function sync() {
            localStorage.setItem('ja_users', JSON.stringify(users));
            localStorage.setItem('ja_pending', JSON.stringify(pending));
            localStorage.setItem('ja_batches', JSON.stringify(batches));
            localStorage.setItem('ja_subs', JSON.stringify(globalSubjects));
        }

        // --- AUTH ---
        function openSheet(id) { document.getElementById(id).style.display='flex'; setTimeout(()=>document.querySelector(`#${id} .sheet`).classList.add('active'),10); if(id==='reg-sheet'){document.getElementById('r-batch').innerHTML=batches.map(b=>`<option>${b}</option>`).join(''); toggleRegFields();} }
        function closeSheet(id) { document.querySelector(`#${id} .sheet`).classList.remove('active'); setTimeout(()=>document.getElementById(id).style.display='none',300); }
        function toggleRegFields() { let r=document.getElementById('r-role').value; document.getElementById('r-stu-fields').style.display=r==='Student'?'block':'none'; document.getElementById('r-tch-fields').style.display=r==='Teacher'?'block':'none'; }

        function login() {
            let id = document.getElementById('l-id').value;
            let u = users.find(x => x.m === id);
            if(u) { currentUser = u; startApp(); } else { alert("Invalid ID"); }
        }

        function doReg() {
            let n=document.getElementById('r-name').value, r=document.getElementById('r-role').value;
            let id = (r==='Student'?'STU':'TCH') + '-' + Math.floor(Math.random()*10000);
            let u = {n:n, m:id, p:'1234', role:r, status:'Pending'};
            if(r==='Student'){ u.batch = document.getElementById('r-batch').value; u.access = globalSubjects; }
            else { u.subjects = document.getElementById('r-subs').value; }
            pending.push(u); sync();
            alert(`‚úÖ Registered!\nID: ${id}`); closeSheet('reg-sheet');
        }

        // --- APP CORE ---
        function startApp() {
            document.getElementById('auth-layer').style.display='none';
            document.getElementById('app-layer').style.display='flex';
            document.getElementById('u-chip').innerText = currentUser.n;
            document.getElementById('greet-text').innerText = `Hello, ${currentUser.n}`;
            
            document.querySelectorAll('.admin-only').forEach(e=>e.style.display=currentUser.role==='Admin'?'block':'none');
            document.querySelectorAll('.teacher-only').forEach(e=>e.style.display=(currentUser.role==='Teacher'||currentUser.role==='Admin')?'block':'none');
            document.getElementById('mood-bar').style.display = currentUser.role==='Student'?'flex':'none';

            let menu = currentUser.role==='Admin' ? ['Admin','Batches','Store','Profile'] : (currentUser.role==='Teacher'?['Batches','Chat','Profile'] : ['Home','Chat','Store','Profile']);
            document.getElementById('bot-nav').innerHTML = menu.map(m=>`<div class="nav-item" onclick="nav('pane-${m.toLowerCase()}')"><i class="material-icons">circle</i>${m}</div>`).join('');
            
            nav('pane-'+menu[0].toLowerCase());
        }

        function nav(id) {
            document.querySelectorAll('.pane').forEach(e=>e.style.display='none');
            document.getElementById(id).style.display='block';
            if(id==='pane-home') renderLB();
            if(id==='pane-admin') renderAdmin('');
            if(id==='pane-batches') renderBatches();
            if(id==='pane-chat') renderChat();
            if(id==='pane-store') renderStore();
            if(id==='pane-profile') { document.getElementById('prof-id').value=currentUser.m; document.getElementById('prof-name').value=currentUser.n; }
        }

        // --- FEATURES ---
        function renderLB() {
            let stu = users.filter(u=>u.role==='Student').sort((a,b)=>(b.marks||0)-(a.marks||0));
            document.getElementById('lb-list').innerHTML = stu.slice(3).map((u,i)=>`<div class="lb-row"><div><b>${u.n}</b></div><span style="color:blue">${u.marks||0}%</span></div>`).join('');
        }

        function renderBatches() { document.getElementById('batch-list').innerHTML = batches.map(b => `<div class="u-card" onclick="openBatch('${b}')" style="cursor:pointer;"><b>${b}</b></div>`).join(''); }
        function openBatch(b) { document.getElementById('batch-view').style.display='block'; document.getElementById('bv-title').innerText=b; renderStuList('view'); }
        function closeBatch() { document.getElementById('batch-view').style.display='none'; }
        function addBatch() { let b=prompt("Name:"); if(b){ batches.push(b); sync(); renderBatches(); } }
        
        function setupMarks() {
            document.getElementById('marks-setup').style.display = 'block';
        }

        function enableMarksEntry() {
            activeTotalMarks = parseInt(document.getElementById('test-total').value) || 100;
            renderStuList('marks');
        }

        function renderStuList(mode) {
            let b = document.getElementById('bv-title').innerText;
            document.getElementById('bv-list').innerHTML = users.filter(u=>u.batch===b && u.role==='Student').map(u => {
                let act = `<small>${u.m}</small>`;
                if(mode==='att') act = `<button class="btn-sec btn-sm">P</button> <button class="btn-sec btn-sm">A</button>`;
                if(mode==='marks') {
                    // PIE CHART LOGIC
                    let pct = Math.round
                    </div>
                    <div id="lb-list"></div>
                </div>
            </div>

            <div id="pane-batches" class="pane" style="display:none;">
                <div class="row"><h3>Batches</h3><button class="btn btn-sec btn-sm admin-only" onclick="addBatch()">+ Batch</button></div>
                <div id="batch-list"></div>
                
                <div id="batch-detail" style="display:none; margin-top:20px; border-top:2px solid #eee; padding-top:20px;">
                    <div class="row"><b id="bd-title">Batch</b><button class="btn btn-sec btn-sm" onclick="document.getElementById('batch-detail').style.display='none'">Close</button></div>
                    
                    <div class="teacher-only" style="background:#f0f9ff; padding:10px; border-radius:10px; margin:10px 0; border:1px solid #bfdbfe;">
                        <b style="color:var(--primary);">‚ö° Quantum Generator</b>
                        <input id="q-topic" placeholder="Topic" style="margin:5px 0;">
                        <div class="row"><select id="q-buf" style="margin:0; width:48%;"><option>No Buffer</option><option>10m Buffer</option></select><button class="btn btn-main btn-sm" style="width:48%;" onclick="alert('Quantum Sent!')">Notify</button></div>
                    </div>

                    <div class="row" style="margin-top:10px;">
                        <b>Students</b>
                        <div class="teacher-only"><button class="btn btn-sec btn-sm" onclick="renderStudents('att')">Att.</button> <button class="btn btn-sec btn-sm" onclick="renderStudents('marks')">Marks</button></div>
                    </div>
                    <div id="bd-list"></div>
                </div>
            </div>

            <div id="pane-chat" class="pane" style="display:none;">
                <div class="u-card"><h3>Messages</h3><div id="chat-list"></div></div>
            </div>

            <div id="pane-store" class="pane" style="display:none;">
                <div class="u-card">
                    <div class="row"><h3>Store</h3><button class="btn btn-sec btn-sm admin-only" onclick="addMaterial()">+ Add</button></div>
                    <h4>Free Demos</h4><div id="demo-list"></div>
                    <h4 style="margin-top:15px;">Premium</h4><div id="store-list"></div>
                </div>
            </div>

            <div id="pane-admin" class="pane" style="display:none;">
                <div class="u-card">
                    <div class="row"><h3>Database</h3><button class="btn btn-sec btn-sm" onclick="alert('Add Logic')">+ User</button></div>
                    <input placeholder="Search..." onkeyup="renderAdmin(this.value)">
                    <div id="admin-list"></div>
                </div>
            </div>

            <div id="pane-profile" class="pane" style="display:none;">
                <div class="u-card">
                    <h4>Profile</h4>
                    <label style="font-size:11px; font-weight:bold;">USER ID</label><input id="prof-id" readonly style="background:#eee;">
                    <label style="font-size:11px; font-weight:bold;">NAME</label><input id="prof-name">
                    <button class="btn btn-main" onclick="alert('Saved')">Update</button>
                </div>
            </div>

        </main>
        <div class="bot-nav" id="bot-nav"></div>
    </div>

    <div id="reg-modal" class="modal-overlay" onclick="hideModals()">
        <div class="modal-box" onclick="event.stopPropagation()">
            <h3>Register</h3>
            <input id="r-name" placeholder="Name">
            <select id="r-role"><option>Student</option><option>Teacher</option></select>
            <input id="r-pass" placeholder="Create PIN">
            <button class="btn btn-main" onclick="handleReg()">Register</button>
            <button class="btn btn-sec" onclick="hideModals()">Close</button>
        </div>
    </div>

    <div id="public-modal" class="modal-overlay" onclick="hideModals()">
        <div class="modal-box" onclick="event.stopPropagation()">
            <h3>Available Courses</h3>
            <div style="padding:10px; border-bottom:1px solid #eee; cursor:pointer;" onclick="aiDesc('Maths')"><b>Maths</b><br><small>Click for AI Info</small></div>
            <div style="padding:10px; border-bottom:1px solid #eee; cursor:pointer;" onclick="aiDesc('Science')"><b>Science</b><br><small>Click for AI Info</small></div>
            <div id="ai-out" style="margin-top:10px; padding:10px; background:#f8fafc; font-size:13px;"></div>
            <button class="btn btn-sec" style="margin-top:10px;" onclick="hideModals()">Close</button>
        </div>
    </div>

    <div id="chat-window" class="chat-win">
        <div class="row" style="padding:15px; border-bottom:1px solid #eee;"><i class="material-icons" onclick="document.getElementById('chat-window').style.display='none'">arrow_back</i><b id="cw-title">Chat</b><div></div></div>
        <div class="chat-body" id="cw-body"></div>
        <div style="padding:10px; border-top:1px solid #eee; display:flex; gap:10px;"><input placeholder="Type..." style="margin:0;"><button class="btn btn-main" style="width:auto;">Send</button></div>
    </div>

    <div id="inspect-modal" class="modal-overlay" onclick="hideModals()">
        <div class="modal-box" onclick="event.stopPropagation()">
            <h3 id="ins-name">User</h3><p id="ins-id">ID</p>
            <button class="btn btn-main" style="background:#f97316;" onclick="simUser()">üëÅÔ∏è Simulate View</button>
        </div>
    </div>

    <script>
        // --- DATA ---
        let users = [
            {n:'Admin', m:'ADM-001', p:'1234', role:'Admin'},
            {n:'Amit Sir', m:'TCH-001', p:'1234', role:'Teacher'},
            {n:'Rohan', m:'STU-001', p:'1234', role:'Student', batch:'Class 10 A', marks:95},
            {n:'Anjali', m:'STU-002', p:'1234', role:'Student', batch:'Class 10 A', marks:98}
        ];
        let batches = ['Class 10 A', 'Class 12'];
        let store = [{t:'Algebra Intro', type:'Demo'}, {t:'Physics PDF', type:'Premium'}];
        let currentUser = null;

        // --- AUTH ---
        function showModal(id) { document.getElementById(id).style.display='flex'; }
        function hideModals() { document.querySelectorAll('.modal-overlay').forEach(e=>e.style.display='none'); }
        
        function handleLogin() {
            let id = document.getElementById('l-id').value;
            let u = users.find(x => x.m === id);
            if(u) { currentUser = u; startApp(); } else { alert("Try ADM-001 / 1234"); }
        }

        function handleReg() {
            let n=document.getElementById('r-name').value, r=document.getElementById('r-role').value;
            let id = (r==='Student'?'STU':'TCH') + '-' + Math.floor(Math.random()*1000);
            users.push({n:n, m:id, p:'1234', role:r, batch:'Class 10 A', marks:0});
            alert("ID: "+id); hideModals();
        }

        // --- APP LOGIC ---
        function startApp() {
            document.getElementById('auth-layer').style.display='none';
            document.getElementById('app-layer').style.display='flex';
            document.getElementById('u-chip').innerText = currentUser.n;
            
            // Greeting
            let h = new Date().getHours();
            document.getElementById('greet-text').innerText = `${h<12?'Good Morning':'Good Evening'}, ${currentUser.n}`;
            document.getElementById('mood-bar').style.display = currentUser.role==='Student'?'flex':'none';

            // Visibility
            document.querySelectorAll('.admin-only').forEach(e=>e.style.display=currentUser.role==='Admin'?'block':'none');
            document.querySelectorAll('.teacher-only').forEach(e=>e.style.display=(currentUser.role==='Teacher'||currentUser.role==='Admin')?'block':'none');

            // Build Nav
            let items = [];
            if(currentUser.role==='Admin') items = ['Admin', 'Batches', 'Store', 'Profile'];
            else if(currentUser.role==='Teacher') items = ['Batches', 'Chat', 'Profile'];
            else items = ['Home', 'Chat', 'Store', 'Profile'];

            let html = items.map(i => {
                let icon = {'Home':'home','Admin':'admin_panel_settings','Batches':'class','Store':'store','Chat':'chat','Profile':'person'}[i];
                return `<div class="nav-item" onclick="showPane('pane-${i.toLowerCase()}')"><i class="material-icons">${icon}</i>${i}</div>`;
            }).join('');
            document.getElementById('bot-nav').innerHTML = html;

            showPane('pane-'+items[0].toLowerCase());
        }

        function showPane(id) {
            document.querySelectorAll('.pane').forEach(e=>e.style.display='none');
            document.getElementById(id).style.display='block';
            
            if(id==='pane-home') renderLeaderboard();
            if(id==='pane-batches') renderBatches();
            if(id==='pane-chat') renderChat();
            if(id==='pane-store') renderStore();
            if(id==='pane-admin') renderAdmin('');
            if(id==='pane-profile') {
                document.getElementById('prof-name').value = currentUser.n;
                document.getElementById('prof-id').value = currentUser.m;
            }
        }

        // --- FEATURES ---
        function renderLeaderboard() {
            document.getElementById('lb-list').innerHTML = users.filter(u=>u.role==='Student').map((u,i)=>
                `<div class="lb-row"><div><b>${u.n}</b></div><span style="color:blue;">${u.marks}%</span></div>`
            ).join('');
        }

        function renderBatches() {
            document.getElementById('batch-list').innerHTML = batches.map(b => 
                `<div class="u-card" onclick="openBatch('${b}')" style="cursor:pointer;"><b>${b}</b></div>`
            ).join('');
        }
        function openBatch(b) {
            document.getElementById('batch-detail').style.display='block';
            document.getElementById('bd-title').innerText = b;
            renderStudents('view');
        }
        function renderStudents(mode) {
            let b = document.getElementById('bd-title').innerText;
            document.getElementById('bd-list').innerHTML = users.filter(u=>u.batch===b && u.role==='Student').map(u => {
                let act = mode==='att' ? `<button class="btn-sec btn-sm">P</button>` : (mode==='marks' ? `<input style="width:40px; margin:0;" placeholder="${u.marks}">` : `<small>${u.m}</small>`);
                return `<div class="row" style="padding:10px; border-bottom:1px solid #eee;"><b>${u.n}</b><div>${act}</div></div>`;
            }).join('');
        }
        function addBatch() { let b=prompt("Name:"); if(b) { batches.push(b); renderBatches(); } }

        function renderChat() {
            let list = currentUser.role==='Student' ? users.filter(u=>u.role==='Teacher') : users.filter(u=>u.role==='Student');
            document.getElementById('chat-list').innerHTML = list.map(u => 
                `<div class="chat-item" onclick="openChat('${u.n}')"><div class="chat-avatar" style="width:30px;height:30px;background:#ddd;border-radius:50%;"></div><b>${u.n}</b></div>`
            ).join('');
        }
        function openChat(n) {
            document.getElementById('chat-window').style.display='flex';
            document.getElementById('cw-title').innerText = n;
            document.getElementById('cw-body').innerHTML = `<div class="msg msg-them">Hello!</div><div class="msg msg-me">Hi there.</div>`;
        }

        function renderStore() {
            document.getElementById('demo-list').innerHTML = store.filter(x=>x.type==='Demo').map(i=>`<div class="store-item"><b>${i.t}</b></div>`).join('');
            document.getElementById('store-list').innerHTML = store.filter(x=>x.type!=='Demo').map(i=>`<div class="store-item"><b>${i.t}</b></div>`).join('');
        }
        function addMaterial() { store.push({t:'New File', type:'Premium'}); renderStore(); }

        function renderAdmin(q) {
            document.getElementById('admin-list').innerHTML = users.filter(u=>u.role!=='Admin' && u.n.toLowerCase().includes(q.toLowerCase())).map(u => 
                `<div class="row" style="padding:10px; border-bottom:1px solid #eee;" onclick="insp('${u.m}')"><b>${u.n}</b><span>${u.role}</span></div>`
            ).join('');
        }
        function insp(id) {
            let u = users.find(x=>x.m===id);
            document.getElementById('inspect-modal').style.display='flex';
            document.getElementById('ins-name').innerText = u.n;
            document.getElementById('ins-id').innerText = u.m;
            document.getElementById('inspect-modal').dataset.mid = id;
        }
        function simUser() {
            currentUser = users.find(x=>x.m===document.getElementById('inspect-modal').dataset.mid);
            hideModals();
            document.getElementById('sim-bar').style.display='block';
            startApp();
        }

        // --- PUBLIC AI ---
        function aiDesc(s) {
            document.getElementById('ai-out').innerText = "Generating AI Syllabus...";
            setTimeout(() => document.getElementById('ai-out').innerHTML = `<b>${s} Syllabus</b><br>AI Generated Content.<br>Topic 1: Intro...`, 1000);
        }
    </script>
</body>
</html>

